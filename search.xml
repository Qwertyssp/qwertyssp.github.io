<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[一个有意思的BUG]]></title>
      <url>/2017/05/21/c-array-point/</url>
      <content type="html"><![CDATA[<p>如果你对C的指针和数组非常了解，就没必要往下看了。否则，还是建议花两分钟看下: )<br><a id="more"></a></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* a.c */</span></div><div class="line"><span class="keyword">int</span> p[<span class="number">10</span>];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">a</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	test[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">////////////////////////////</span></div><div class="line"><span class="comment">/* b.c */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="keyword">extern</span> <span class="keyword">int</span> *p;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">b</span> <span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, p[<span class="number">0</span>])</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">////////////////////////////</span></div><div class="line"><span class="comment">/* main.c */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"a.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"b.h"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	a();</div><div class="line">	b();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>代码很简单，请仔细阅读，然后回答我的两个问题</p>
<ul>
<li><p>问题1：这段代码输出什么？</p>
<blockquote>
<p>如果你认为是1，那么恭喜你，今天你又要学到新的东西了。<br>  正确答案是编译运行后是<strong>”segmentation fault“</strong> :(, oh no, WTF!!!</p>
</blockquote>
</li>
<li><p>问题2: 为什么会这样？</p>
<blockquote>
<p>原因就在与：数组和指针并不相同。</p>
</blockquote>
</li>
</ul>
<p>虽然初出茅庐的时候就知道数组与指针的差异，但还是在被某位大神鄙视后，也没有醒悟。</p>
<h3 id="WHY"><a href="#WHY" class="headerlink" title="WHY !!!???"></a>WHY !!!???</h3><p>我们首先需要明白两个问题</p>
<ul>
<li><p>区分定义和声明<br>声明相当于普通的声明：它所说明的并非自身，而是描述其他地方的创建的对象.<br>定义相当于特殊的声明：它为对象分配内存.</p>
</li>
<li><p>指针与数组的区别之一<br>指针间接访问数据，首先取得指针的内容，把它作为地址，然后从这个地址提取数据.<br>数组直接访问数据，a[i]只是简单的以a+i为地址取得数据.</p>
</li>
</ul>
<p>那么当我在b.c以extern int *p,然后用p[0]来引用其中的元素时，编译器做了什么呢？</p>
<ol>
<li>取得符号表中p的地址，提取存储在此处的指针</li>
<li>把下表所表示的偏移量与指针的值想家，产生一个地址。</li>
<li>访问上面这个地址，取得字符。</li>
</ol>
<p>也就是说当用p[i]这种形式提取这个声明的内容时，编译器却把他当成了一个指针，把1解释为地址显然是不对的</p>
<h3 id="我们应当怎么做"><a href="#我们应当怎么做" class="headerlink" title="我们应当怎么做"></a>我们应当怎么做</h3><p>指针的外部声明与数组定义不匹配的问题很容易修正，只要修改声明，使之与定义相匹配即可。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//file1</span></div><div class="line"><span class="keyword">int</span> a[<span class="number">100</span>]</div><div class="line"></div><div class="line"><span class="comment">//file2</span></div><div class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a[];</div></pre></td></tr></table></figure></p>
<p>这里只是简单剖析了下这个问题，也算是一个记录，如果想深入了解，建议还是看下<em>C专家编程</em>这本书</p>
]]></content>
      
        <categories>
            
            <category> C/C++ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 编程语言 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[New Start]]></title>
      <url>/2017/03/27/new-start/</url>
      <content type="html"><![CDATA[<p>之前写过一些blog，但是零零散散，其实也没什么质量可言，又因为工作原因，时常没有心情想去整理。</p>
<p>由于最近在看一些技术博客，收益颇丰，所以决定重新写Blog，之前的文章就有时间再同步过来吧。</p>
<blockquote>
<p>希望这次可以坚持:)</p>
</blockquote>
<p><img src="bird.jpeg" alt=""></p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 心情 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
